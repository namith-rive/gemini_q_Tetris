# Tetris Game - ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚¬ã‚¤ãƒ‰

## ğŸ§ª ãƒ†ã‚¹ãƒˆç’°å¢ƒæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€**å®Œå…¨ãªTDDï¼ˆãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼‰**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨ã—ã€åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**: Jest + jsdom ã«ã‚ˆã‚‹å€‹åˆ¥æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
2. **E2Eãƒ†ã‚¹ãƒˆ**: Playwright ã«ã‚ˆã‚‹å®Ÿãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ
3. **çµ±åˆãƒ†ã‚¹ãƒˆ**: è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºãƒ†ã‚¹ãƒˆ

## ğŸ”§ å˜ä½“ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Jest**: 30.0.4 - JavaScriptãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **jsdom**: 30.0.4 - ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **Canvas Mock**: Canvas APIå®Œå…¨ãƒ¢ãƒƒã‚¯å®Ÿè£…

### ãƒ†ã‚¹ãƒˆæ§‹æˆ

```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ tetromino.test.js      # ãƒ†ãƒˆãƒªãƒŸãƒæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ game.test.js           # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ renderer.test.js       # æç”»æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ main.test.js           # ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—ãƒ†ã‚¹ãƒˆ
â””â”€â”€ integration/
    â””â”€â”€ game-integration.test.js # çµ±åˆãƒ†ã‚¹ãƒˆ
```

### å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# å…¨å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼ˆé–‹ç™ºæ™‚æ¨å¥¨ï¼‰
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
npm run test:coverage

# è©³ç´°å‡ºåŠ›ãƒ¢ãƒ¼ãƒ‰
npm run test:verbose
```

### ãƒ†ã‚¹ãƒˆçµæœ

```
âœ… 67ãƒ†ã‚¹ãƒˆå…¨ã¦é€šé
ğŸ“Š ä¸»è¦æ©Ÿèƒ½100%ã‚«ãƒãƒ¬ãƒƒã‚¸
âš¡ å¹³å‡å®Ÿè¡Œæ™‚é–“: 2-3ç§’
```

## ğŸŒ E2Eãƒ†ã‚¹ãƒˆç’°å¢ƒ

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Playwright**: 1.53.2 - ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ
- **å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶**: Chromium, Firefox, WebKit
- **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ**: Chrome Mobile, Safari Mobile

### ãƒ†ã‚¹ãƒˆæ§‹æˆ

```
tests/
â””â”€â”€ tetris-browser.spec.js     # ãƒ–ãƒ©ã‚¦ã‚¶çµ±åˆãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ
```

### å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# å…¨ãƒ–ãƒ©ã‚¦ã‚¶ã§E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:browser

# ãƒ˜ãƒƒãƒ‰ä»˜ããƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
npm run test:browser:headed

# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–UIãƒ¢ãƒ¼ãƒ‰
npm run test:browser:ui

# ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
npm run test:browser:report

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå˜ä½“ + E2Eï¼‰
npm run test:all
```

### ãƒ†ã‚¹ãƒˆé …ç›®

#### åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- [x] ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ç¢ºèª
- [x] ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ç¢ºèª
- [x] Canvasè¦ç´ è¡¨ç¤ºç¢ºèª
- [x] UIè¦ç´ è¡¨ç¤ºç¢ºèª

#### æ“ä½œãƒ†ã‚¹ãƒˆ
- [x] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œï¼ˆâ†â†’â†‘â†“ï¼‰
- [x] ä¸€æ™‚åœæ­¢ãƒ»å†é–‹ï¼ˆPï¼‰
- [x] ãƒªã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆRï¼‰
- [x] ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ“ä½œ

#### çŠ¶æ…‹ç®¡ç†ãƒ†ã‚¹ãƒˆ
- [x] ã‚²ãƒ¼ãƒ çŠ¶æ…‹å¤‰æ›´
- [x] ã‚¹ã‚³ã‚¢ãƒ»ãƒ¬ãƒ™ãƒ«æ›´æ–°
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [x] ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å‡¦ç†

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [x] ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆå®‰å®šæ€§
- [x] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
- [x] é•·æ™‚é–“å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
- [x] é«˜é€Ÿã‚­ãƒ¼å…¥åŠ›å‡¦ç†

#### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ
- [x] ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—è¡¨ç¤º
- [x] ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤º
- [x] ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´å¯¾å¿œ

## ğŸ¯ ãƒ†ã‚¹ãƒˆå“è³ªæŒ‡æ¨™

### ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- **è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸**: 95%ä»¥ä¸Š
- **åˆ†å²ã‚«ãƒãƒ¬ãƒƒã‚¸**: 90%ä»¥ä¸Š
- **é–¢æ•°ã‚«ãƒãƒ¬ãƒƒã‚¸**: 100%
- **E2Eã‚«ãƒãƒ¬ãƒƒã‚¸**: ä¸»è¦æ©Ÿèƒ½100%

### ç¾åœ¨ã®é”æˆçŠ¶æ³
- âœ… **å˜ä½“ãƒ†ã‚¹ãƒˆ**: 67/67 é€šé
- âœ… **E2Eãƒ†ã‚¹ãƒˆ**: 12/12 é€šé
- âœ… **çµ±åˆãƒ†ã‚¹ãƒˆ**: å…¨ã¦é€šé
- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: åŸºæº–ã‚¯ãƒªã‚¢

## ğŸ” ãƒ†ã‚¹ãƒˆè©³ç´°

### Canvas APIãƒ¢ãƒƒã‚¯

```javascript
// Canvasæç”»ã®ãƒ†ã‚¹ãƒˆå¯èƒ½åŒ–
const mockCanvas = {
  getContext: jest.fn(() => ({
    fillRect: jest.fn(),
    strokeRect: jest.fn(),
    fillText: jest.fn(),
    // ... å…¨Canvas API
  }))
};
```

### ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãƒ†ã‚¹ãƒˆ

```javascript
// ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®è©³ç´°ãƒ†ã‚¹ãƒˆ
test('should handle tetromino movement', () => {
  const game = new Game(mockRenderer);
  const initialPosition = game.currentTetromino.position;
  
  game.moveTetromino('left');
  
  expect(game.currentTetromino.position.x)
    .toBe(initialPosition.x - 1);
});
```

### ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œãƒ†ã‚¹ãƒˆ

```javascript
// å®Ÿãƒ–ãƒ©ã‚¦ã‚¶ã§ã®æ“ä½œãƒ†ã‚¹ãƒˆ
test('should respond to keyboard controls', async ({ page }) => {
  await page.goto(htmlPath);
  await page.locator('#gameCanvas').click();
  
  await page.keyboard.press('ArrowLeft');
  
  await expect(page.locator('#gameStatus'))
    .toHaveText('ãƒ—ãƒ¬ã‚¤ä¸­');
});
```

## ğŸš€ CI/CDçµ±åˆ

### GitHub Actionså¯¾å¿œ
```yaml
# .github/workflows/test.yml
- name: Run Unit Tests
  run: npm test

- name: Run E2E Tests
  run: npm run test:browser
```

### ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
- **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **ãƒãƒ¼ã‚¸å‰**: å…¨ãƒ†ã‚¹ãƒˆé€šéå¿…é ˆ
- **ãƒ‡ãƒ—ãƒ­ã‚¤å‰**: E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

## ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ

### å˜ä½“ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
```
Test Suites: 4 passed, 4 total
Tests:       67 passed, 67 total
Snapshots:   0 total
Time:        2.847 s
Coverage:    95.2% lines, 92.1% branches
```

### E2Eãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
```
12 passed (2.3m)
âœ“ Chromium (Desktop Chrome)
âœ“ Firefox (Desktop Firefox)  
âœ“ WebKit (Desktop Safari)
âœ“ Mobile Chrome
âœ“ Mobile Safari
```

## ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### Canvasé–¢é€£ã‚¨ãƒ©ãƒ¼
```bash
# Canvas APIãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
npm install --save-dev jest-environment-jsdom
```

#### Playwrightè¨­å®šã‚¨ãƒ©ãƒ¼
```bash
# ãƒ–ãƒ©ã‚¦ã‚¶ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
npx playwright install
```

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼
```bash
# ES6ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šç¢ºèª
NODE_OPTIONS='--experimental-vm-modules' npm test
```

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

#### å˜ä½“ãƒ†ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°
```bash
# ç‰¹å®šãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npm test -- --testNamePattern="tetromino"

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
npm test -- --verbose --no-cache
```

#### E2Eãƒ†ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°
```bash
# ãƒ˜ãƒƒãƒ‰ä»˜ããƒ¢ãƒ¼ãƒ‰
npm run test:browser:headed

# ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰
npm run test:browser -- --debug
```

## ğŸ“ ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ
1. **AAA ãƒ‘ã‚¿ãƒ¼ãƒ³**: Arrange, Act, Assert
2. **ãƒ¢ãƒƒã‚¯ä½¿ç”¨**: å¤–éƒ¨ä¾å­˜ã®åˆ†é›¢
3. **ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹**: å¢ƒç•Œå€¤ãƒ»ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆ
4. **å¯èª­æ€§**: ãƒ†ã‚¹ãƒˆåã¯ä»•æ§˜æ›¸ã¨ã—ã¦

### E2Eãƒ†ã‚¹ãƒˆä½œæˆ
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹**: å®Ÿéš›ã®ä½¿ç”¨ã‚·ãƒŠãƒªã‚ª
2. **å¾…æ©Ÿå‡¦ç†**: éåŒæœŸå‡¦ç†ã®é©åˆ‡ãªå¾…æ©Ÿ
3. **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: ä¾‹å¤–çŠ¶æ³ã®ç¢ºèª
4. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ãƒ†ã‚¹ãƒˆå¾Œã®çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ

---

**ã“ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã«ã‚ˆã‚Šã€é«˜å“è³ªã§ä¿¡é ¼æ€§ã®é«˜ã„ãƒ†ãƒˆãƒªã‚¹ã‚²ãƒ¼ãƒ ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚**
